var Modal,wcap_clicked_cart_id,$wcap_get_email_address,$wcap_customer_details,$wcap_cart_total,$wcap_abandoned_date,$wcap_abandoned_status,email_body,$wcap_cart_status,$wcap_show_customer_detail;jQuery(function(a){(Modal={init:function(){a(document.body).on("click",".wcap-js-close-modal",this.close),a(document.body).on("click",".wcap-modal-overlay",this.close),a(document.body).on("click",".wcap-js-open-modal",this.handle_link),a(document.body).on("click",".wcap_customer_detail_modal",this.handle_customer_details),a(document.body).on("mousedown",".wcap-js-open-modal",this.handle_link_mouse_middle_click),a(document.body).on("click",".wcap_admin_unsubscribe",this.wcap_admin_unsubscribe),a(window).resize(function(){Modal.position()}),a(document).keydown(function(a){27==a.keyCode&&Modal.close()})},handle_customer_details:function(t){t.preventDefault(),-1==a(t.target).text().indexOf("Hide")?(a(".wcap_modal_customer_all_details").fadeIn(),Modal.position(),a(t.target).text("Hide Details")):(a(".wcap_modal_customer_all_details").fadeOut(),Modal.position(),a(t.target).text("Show Details"))},handle_link_mouse_middle_click:function(a){if(2==a.which){var t=window.location.href;return this.href=t,a.preventDefault(),!1}},handle_link:function(t){t.preventDefault();var e,d,c=a(this),o="";if(-1==window.location.href.indexOf("action=emailstats")?(e=(d=c.closest("tr")[0]).getElementsByTagName("td")[1].innerHTML.split("<div")[0],$wcap_customer_details=d.getElementsByTagName("td")[2].innerHTML,$wcap_cart_total=d.getElementsByTagName("td")[3].innerHTML,$wcap_abandoned_date=d.getElementsByTagName("td")[4].innerHTML,$wcap_abandoned_status=d.getElementsByClassName("status")[0].firstChild.innerText,$wcap_cart_status=$wcap_abandoned_status):(o="send_email",e="",$wcap_customer_details="",$wcap_cart_total="",$wcap_abandoned_date="",$wcap_cart_status=""),email_body='<div class="wcap-modal__body"> <div class="wcap-modal__body-inner"> <table cellspacing="0" cellpadding="6" border="1" class="wcap-cart-table"> <thead><th>Email Address</th><th>Customer Details</th><th>Order Total</th><th> Abandoned Date</th></tr></thead><tbody><tr><td>'+e+"</td><td>"+$wcap_customer_details+($wcap_show_customer_detail='<br><a href="#" id "wcap_customer_detail_modal"> Show Details </a>')+"</td><td>"+$wcap_cart_total+" </td><td>"+$wcap_abandoned_date+" </td></tr></tbody></table></div> </div>","ajax"==c.data("modal-type")){wcap_clicked_cart_id=c.data("wcap-cart-id"),Modal.open("type-ajax"),Modal.loading();var i={action:"wcap_abandoned_cart_info",wcap_cart_id:wcap_clicked_cart_id,wcap_email_address:e,wcap_customer_details:$wcap_customer_details,wcap_cart_total:$wcap_cart_total,wcap_abandoned_date:$wcap_abandoned_date,wcap_abandoned_status:$wcap_cart_status,wcap_current_page:o};a.post(ajaxurl,i,function(a){Modal.contents(a)})}},open:function(t){a(document.body).addClass("wcap-modal-open").append('<div class="wcap-modal-overlay"></div>');var e='<div class="wcap-modal '+t+'"><div class="wcap-modal__contents"> <div class="wcap-modal__header"><h1>Cart #'+wcap_clicked_cart_id+"</h1>"+$wcap_cart_status+"</div>"+email_body+' <div class = "wcap-modal-cart-content-hide" id ="wcap_remove_class">  </div> </div>  <div class="wcap-icon-close wcap-js-close-modal"></div>    </div>';a(document.body).append(e),this.position()},loading:function(){a(document.body).addClass("wcap-modal-loading")},contents:function(t){a(document.body).removeClass("wcap-modal-loading"),t=t.replace(/\\(.)/gm,"$1"),a(".wcap-modal__contents").html(t),this.position()},close:function(){a(document.body).removeClass("wcap-modal-open wcap-modal-loading"),a(".wcap-modal, .wcap-modal-overlay").remove()},position:function(){a(".wcap-modal__body").removeProp("style");var t=a(".wcap-modal__header").outerHeight(),e=a(".wcap-modal").height(),d=a(".wcap-modal").width(),c=a(".wcap-modal__body").outerHeight()+t;a(".wcap-modal").css({"margin-left":-d/2,"margin-top":-e/2}),e<c-5&&a(".wcap-modal__body").height(e-t)},wcap_admin_unsubscribe:function(){var t=a(this),e={action:"wcap_admin_unsubscribe_cart",wcap_cart_id:wcap_clicked_cart_id=t.data("wcap-cart-id")};return t.text("Processing..."),a.post(ajaxurl,e,function(e){t.text(e.data),setTimeout(function(){a(".wcap-js-close-modal").click(),location.reload()},500)}),!1}}).init()});